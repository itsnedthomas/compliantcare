<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CompliantCare | Healthcare Facility CRM</title>
    <link rel="stylesheet" href="styles/crm.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
    <!-- Loading -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loader"></div>
            <div id="loading-status" class="loading-status">Loading facilities...</div>
            <div class="loading-progress-container">
                <div id="loading-progress" class="loading-progress" style="width: 0%"></div>
            </div>
            <div id="loading-count" class="loading-count">0 / 13,000+ records</div>
        </div>
    </div>

    <div class="app">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                        <rect width="24" height="24" rx="6" fill="#10b981" />
                        <path d="M7 12l3 3 7-7" stroke="white" stroke-width="2" stroke-linecap="round"
                            stroke-linejoin="round" />
                    </svg>
                    <span>CompliantCare</span>
                </div>
            </div>

            <nav class="sidebar-nav">
                <a href="#" class="nav-link active" data-view="dashboard">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M10.707 2.293a1 1 0 00-1.414 0l-7 7a1 1 0 001.414 1.414L4 10.414V17a1 1 0 001 1h2a1 1 0 001-1v-2a1 1 0 011-1h2a1 1 0 011 1v2a1 1 0 001 1h2a1 1 0 001-1v-6.586l.293.293a1 1 0 001.414-1.414l-7-7z" />
                    </svg>
                    Home
                </a>
                <a href="#" class="nav-link" data-view="list">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4z" />
                    </svg>
                    Properties
                    <span class="nav-badge" id="facilities-count">0</span>
                </a>
                <a href="#" class="nav-link" data-view="providers">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
                    </svg>
                    Providers
                    <span class="nav-badge" id="providers-count">0</span>
                </a>
                <a href="#" class="nav-link" data-view="people">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                            clip-rule="evenodd" />
                    </svg>
                    People
                    <span class="nav-badge" id="people-count">0</span>
                </a>
                <a href="#" class="nav-link" data-view="map">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M12 1.586l-4 4v12.828l4-4V1.586zM3.707 3.293A1 1 0 002 4v10a1 1 0 00.293.707L6 18.414V5.586L3.707 3.293zM17.707 5.293L14 1.586v12.828l2.293 2.293A1 1 0 0018 16V6a1 1 0 00-.293-.707z"
                            clip-rule="evenodd" />
                    </svg>
                    Map View
                </a>
                <a href="#" class="nav-link" data-view="pipeline">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path
                            d="M3 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1H4a1 1 0 01-1-1V4zM8 4a1 1 0 011-1h2a1 1 0 011 1v12a1 1 0 01-1 1H9a1 1 0 01-1-1V4zM14 3a1 1 0 00-1 1v12a1 1 0 001 1h2a1 1 0 001-1V4a1 1 0 00-1-1h-2z" />
                    </svg>
                    Pipeline
                    <span class="nav-badge" id="pipeline-count">0</span>
                </a>
                <a href="#" class="nav-link" data-view="enrichment">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M11.3 1.046A1 1 0 0112 2v5h4a1 1 0 01.82 1.573l-7 10A1 1 0 018 18v-5H4a1 1 0 01-.82-1.573l7-10a1 1 0 011.12-.38z"
                            clip-rule="evenodd" />
                    </svg>
                    Enrichment
                </a>
            </nav>

            <div class="sidebar-footer user-section" id="user-section" style="display: none;">
                <div class="user-info">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <div class="user-details">
                        <span class="user-email" id="user-email">user@example.com</span>
                    </div>
                </div>
                <button class="btn-logout" onclick="AuthHandler.signOut()">
                    <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd"
                            d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z"
                            clip-rule="evenodd" />
                    </svg>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main">
            <!-- Dashboard View -->
            <section id="dashboard-view" class="view active">
                <header class="view-header">
                    <div>
                        <h1>Dashboard</h1>
                        <p class="subtitle">
                            <span class="status-dot"></span>
                            Live facility data
                        </p>
                    </div>
                    <div class="header-actions">
                        <div class="search-box">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                    clip-rule="evenodd" />
                            </svg>
                            <input type="text" id="search-input" placeholder="Search facilities...">
                        </div>
                        <button class="btn btn-primary" onclick="CRMApp.exportData()">Export</button>
                    </div>
                </header>

                <!-- Stats Cards -->
                <div class="stats-row">
                    <div class="stat-card stat-card-fixed">
                        <div class="stat-label">Total Care Homes</div>
                        <div class="stat-value" id="stat-total">0</div>
                        <div class="stat-chart" id="spark-total"></div>
                    </div>
                    <div class="stats-ratings">
                        <div class="stat-card stat-card-rating">
                            <div class="stat-icon green">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="stat-outstanding">0</div>
                                <div class="stat-label">Outstanding</div>
                            </div>
                            <div class="stat-pct" id="stat-outstanding-pct">0%</div>
                        </div>
                        <div class="stat-card stat-card-rating">
                            <div class="stat-icon blue">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="stat-good">0</div>
                                <div class="stat-label">Good</div>
                            </div>
                            <div class="stat-pct" id="stat-good-pct">0%</div>
                        </div>
                        <div class="stat-card stat-card-rating">
                            <div class="stat-icon orange">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="stat-requires">0</div>
                                <div class="stat-label">Requires Improvement</div>
                            </div>
                            <div class="stat-pct" id="stat-requires-pct">0%</div>
                        </div>
                        <div class="stat-card stat-card-rating">
                            <div class="stat-icon red">
                                <svg width="18" height="18" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <div class="stat-content">
                                <div class="stat-number" id="stat-inadequate">0</div>
                                <div class="stat-label">Inadequate</div>
                            </div>
                            <div class="stat-pct" id="stat-inadequate-pct">0%</div>
                        </div>
                    </div>
                </div>

                <!-- Charts Row: Rating Distribution Donut + Regional Breakdown -->
                <div class="charts-grid">
                    <div class="card analytics-card">
                        <div class="card-header">
                            <h3>Rating Distribution</h3>
                            <span class="card-subtitle">All facilities</span>
                        </div>
                        <div class="card-body">
                            <div class="chart-container donut-container"
                                style="height: 250px; display: flex; align-items: center; justify-content: center;">
                                <canvas id="rating-donut-chart"></canvas>
                            </div>
                            <div class="chart-legend" id="rating-donut-legend"></div>
                        </div>
                    </div>
                    <div class="card analytics-card">
                        <div class="card-header">
                            <h3>Regional Breakdown</h3>
                            <button class="btn-icon" id="regional-sort-btn" title="Toggle sort order">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path
                                        d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zM3 7a1 1 0 000 2h7a1 1 0 100-2H3zM3 11a1 1 0 100 2h4a1 1 0 100-2H3zM15 8a1 1 0 10-2 0v5.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L15 13.586V8z" />
                                </svg>
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="regional-breakdown-chart" id="regional-breakdown-bars"></div>
                        </div>
                    </div>
                </div>

                <!-- Outstanding Facilities -->
                <div class="card">
                    <div class="card-header">
                        <h3>Outstanding Facilities</h3>
                        <a href="#" class="link" onclick="CRMApp.switchView('list'); return false;">View all →</a>
                    </div>
                    <div class="card-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Facility</th>
                                    <th>Location</th>
                                    <th>Provider</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="outstanding-table"></tbody>
                        </table>
                    </div>
                </div>

                <!-- Analytics Section -->
                <div class="section-divider">
                    <h2>Analytics Overview</h2>
                </div>

                <!-- Charts Row: Donut + Rating by Region -->
                <div class="charts-grid">
                    <div class="card analytics-card">
                        <div class="card-header">
                            <h3>Rating Breakdown</h3>
                            <span class="card-subtitle" id="home-donut-subtitle">All care homes</span>
                        </div>
                        <div class="card-body">
                            <div class="chart-container donut-container">
                                <canvas id="home-rating-donut-chart"></canvas>
                            </div>
                            <div class="chart-legend" id="home-donut-legend"></div>
                        </div>
                    </div>
                    <div class="card analytics-card">
                        <div class="card-header">
                            <h3>Ratings by Region</h3>
                            <div class="chart-view-toggle">
                                <button class="view-btn active" data-view="stacked" data-chart="home">Stacked</button>
                                <button class="view-btn" data-view="grouped" data-chart="home">Grouped</button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="chart-container bar-container">
                                <canvas id="home-region-ratings-chart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Regional Breakdown + Top Providers -->
                <div class="charts-grid">
                    <div class="card analytics-card">
                        <div class="card-header">
                            <h3>Regional Breakdown</h3>
                            <button class="btn-icon sort-btn" id="home-sort-regions-btn" title="Sort">
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path
                                        d="M3 3a1 1 0 000 2h11a1 1 0 100-2H3zm0 4a1 1 0 000 2h7a1 1 0 100-2H3zm0 4a1 1 0 100 2h4a1 1 0 100-2H3z" />
                                </svg>
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="regional-bars" id="home-regional-bars"></div>
                        </div>
                    </div>
                    <div class="card analytics-card">
                        <div class="card-header">
                            <h3>Top Providers</h3>
                            <span class="card-subtitle">By facility count</span>
                        </div>
                        <div class="card-body">
                            <div class="providers-table" id="home-top-providers-table"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- List View -->
            <section id="list-view" class="view">
                <header class="view-header">
                    <div>
                        <h1>All Properties</h1>
                        <p class="subtitle" id="list-count">0 properties</p>
                    </div>
                    <div class="header-actions">
                        <div class="tabs">
                            <button class="tab active" data-filter="">All</button>
                            <button class="tab" data-filter="Outstanding">Outstanding</button>
                            <button class="tab" data-filter="Good">Good</button>
                            <button class="tab" data-filter="Requires improvement">Requires Improvement</button>
                        </div>
                    </div>
                </header>

                <div class="card">
                    <table class="data-table full">
                        <thead>
                            <tr>
                                <th><input type="checkbox"></th>
                                <th>Property Name</th>
                                <th>Status</th>
                                <th>Location</th>
                                <th>Provider</th>
                                <th>Type</th>
                            </tr>
                        </thead>
                        <tbody id="facilities-table"></tbody>
                    </table>
                </div>

                <div class="pagination" id="pagination"></div>
            </section>

            <!-- Map View -->
            <section id="map-view" class="view">
                <header class="view-header compact">
                    <div>
                        <h1>UK Properties Map</h1>
                        <p class="subtitle">
                            <span class="dot green"></span> Outstanding
                            <span class="dot blue"></span> Good
                            <span class="dot orange"></span> Requires Improvement
                            <span class="dot red"></span> Inadequate
                        </p>
                    </div>
                    <div class="header-actions">
                        <div class="search-box">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                    clip-rule="evenodd" />
                            </svg>
                            <input type="text" id="map-search" placeholder="Search location...">
                        </div>
                    </div>
                </header>
                <div class="map-container">
                    <div id="map"></div>
                </div>
            </section>

            <!-- Providers View -->
            <section id="providers-view" class="view">
                <header class="view-header">
                    <div>
                        <h1>Providers</h1>
                        <p class="subtitle" id="providers-subtitle">0 providers managing facilities</p>
                    </div>
                    <div class="header-actions">
                        <div class="search-box">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                    clip-rule="evenodd" />
                            </svg>
                            <input type="text" id="provider-search" placeholder="Search providers...">
                        </div>
                        <div class="multi-select-dropdown" id="provider-count-filter">
                            <button class="multi-select-trigger" type="button">
                                <span class="multi-select-label">All Providers</span>
                                <svg width="12" height="12" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd"
                                        d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z"
                                        clip-rule="evenodd" />
                                </svg>
                            </button>
                            <div class="multi-select-menu">
                                <label class="multi-select-item">
                                    <input type="checkbox" value="1-2"> 1-2 Properties
                                </label>
                                <label class="multi-select-item">
                                    <input type="checkbox" value="3-5"> 3-5 Properties
                                </label>
                                <label class="multi-select-item">
                                    <input type="checkbox" value="6-10"> 6-10 Properties
                                </label>
                                <label class="multi-select-item">
                                    <input type="checkbox" value="11-15"> 11-15 Properties
                                </label>
                                <label class="multi-select-item">
                                    <input type="checkbox" value="16-20"> 16-20 Properties
                                </label>
                                <label class="multi-select-item">
                                    <input type="checkbox" value="21-30"> 21-30 Properties
                                </label>
                                <label class="multi-select-item">
                                    <input type="checkbox" value="31-40"> 31-40 Properties
                                </label>
                                <label class="multi-select-item">
                                    <input type="checkbox" value="41-50"> 41-50 Properties
                                </label>
                                <label class="multi-select-item">
                                    <input type="checkbox" value="50+"> 50+ Properties
                                </label>
                            </div>
                        </div>
                        <select id="provider-region-filter" class="provider-filter-select">
                            <option value="">All Regions</option>
                        </select>
                    </div>
                </header>

                <div class="providers-grid" id="providers-grid"></div>

                <div class="pagination" id="providers-pagination"></div>
            </section>

            <!-- People View -->
            <section id="people-view" class="view">
                <header class="view-header">
                    <div>
                        <h1>People</h1>
                        <p class="subtitle" id="people-subtitle">0 decision makers</p>
                    </div>
                    <div class="header-actions">
                        <div class="search-box">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z"
                                    clip-rule="evenodd" />
                            </svg>
                            <input type="text" id="people-search" placeholder="Search people...">
                        </div>
                        <select id="people-region-filter" class="provider-filter-select">
                            <option value="">All Regions</option>
                        </select>
                        <select id="people-beds-filter" class="provider-filter-select">
                            <option value="">All Sizes</option>
                            <option value="0-50">1-50 beds</option>
                            <option value="51-200">51-200 beds</option>
                            <option value="201-500">201-500 beds</option>
                            <option value="501+">500+ beds</option>
                        </select>
                        <select id="people-outreach-filter" class="provider-filter-select">
                            <option value="">All Status</option>
                            <option value="not-contacted">Not Contacted</option>
                            <option value="contacted">Contacted</option>
                        </select>
                    </div>
                </header>


                <div class="people-grid" id="people-grid"></div>

                <div class="pagination" id="people-pagination"></div>
            </section>

            <!-- Pipeline View -->
            <section id="pipeline-view" class="view">
                <header class="view-header">
                    <div>
                        <h1>Pipeline</h1>
                        <p class="subtitle" id="pipeline-subtitle">GoHighLevel Opportunities</p>
                    </div>
                    <div class="header-actions">
                        <select id="pipeline-selector" class="pipeline-select">
                            <option value="">Loading pipelines...</option>
                        </select>
                        <button class="btn btn-primary" id="sync-pipeline-btn" onclick="PipelineView.syncPipeline()">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd"
                                    d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                                    clip-rule="evenodd" />
                            </svg>
                            Sync
                        </button>
                    </div>
                </header>

                <div class="pipeline-board" id="pipeline-board">
                    <div class="pipeline-loading" id="pipeline-loading">
                        <div class="loader"></div>
                        <p>Loading pipeline data...</p>
                    </div>
                    <div class="pipeline-error" id="pipeline-error" style="display: none;">
                        <svg width="48" height="48" viewBox="0 0 20 20" fill="currentColor"
                            style="color: var(--color-warning);">
                            <path fill-rule="evenodd"
                                d="M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z"
                                clip-rule="evenodd" />
                        </svg>
                        <h3>API Key Required</h3>
                        <p id="pipeline-error-message">Please add your GoHighLevel Location API key to access pipeline
                            data.</p>
                        <a href="https://help.gohighlevel.com/support/solutions/articles/155000002308-what-is-the-api-key-and-how-can-i-find-it-"
                            target="_blank" class="btn btn-secondary">How to get API key</a>
                    </div>
                    <div class="pipeline-columns" id="pipeline-columns"></div>
                </div>
            </section>

            <!-- Enrichment Status View -->
            <section id="enrichment-view" class="view">
                <header class="view-header">
                    <div>
                        <h1>Enrichment Status</h1>
                        <p class="subtitle" id="enrichment-subtitle">
                            <span class="status-dot live"></span>
                            Live enrichment progress
                        </p>
                    </div>
                    <div class="header-actions">
                        <button class="btn btn-primary" id="refresh-enrichment-btn"
                            onclick="EnrichmentStatus.refresh()">
                            <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor" class="refresh-icon">
                                <path fill-rule="evenodd"
                                    d="M4 2a1 1 0 011 1v2.101a7.002 7.002 0 0111.601 2.566 1 1 0 11-1.885.666A5.002 5.002 0 005.999 7H9a1 1 0 010 2H4a1 1 0 01-1-1V3a1 1 0 011-1zm.008 9.057a1 1 0 011.276.61A5.002 5.002 0 0014.001 13H11a1 1 0 110-2h5a1 1 0 011 1v5a1 1 0 11-2 0v-2.101a7.002 7.002 0 01-11.601-2.566 1 1 0 01.61-1.276z"
                                    clip-rule="evenodd" />
                            </svg>
                            Refresh
                        </button>
                    </div>
                </header>

                <!-- Progress Section -->
                <div class="enrichment-progress-section">
                    <div class="card enrichment-progress-card">
                        <div class="enrichment-stats-row">
                            <div class="enrichment-stat">
                                <span class="stat-number" id="enriched-count">0</span>
                                <span class="stat-label">Enriched</span>
                            </div>
                            <div class="enrichment-stat">
                                <span class="stat-number" id="total-care-homes">13,726</span>
                                <span class="stat-label">Total Care Homes</span>
                            </div>
                            <div class="enrichment-stat">
                                <span class="stat-number" id="enrichment-percent">0%</span>
                                <span class="stat-label">Complete</span>
                            </div>
                            <div class="enrichment-stat">
                                <span class="stat-number" id="enrichment-eta">--</span>
                                <span class="stat-label">ETA (mins)</span>
                            </div>
                        </div>
                        <div class="enrichment-progress-bar-container">
                            <div class="enrichment-progress-bar" id="enrichment-progress-bar" style="width: 0%"></div>
                        </div>
                        <div class="enrichment-progress-label">
                            <span id="enrichment-progress-text">0 / 13,726 care homes enriched</span>
                        </div>
                    </div>
                </div>

                <!-- Live Feed -->
                <div class="card enrichment-feed-card">
                    <div class="card-header">
                        <h3>
                            <span class="live-indicator"></span>
                            Recently Enriched
                        </h3>
                        <span class="card-subtitle" id="feed-update-time">Last updated: --</span>
                    </div>
                    <div class="card-body">
                        <div class="enrichment-feed" id="enrichment-feed">
                            <div class="feed-loading">
                                <div class="loader"></div>
                                <p>Loading enrichment data...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- Detail Panel -->
        <aside id="detail-panel" class="detail-panel">
            <div class="detail-header">
                <h2 id="detail-title">Facility Details</h2>
                <button class="btn-close" onclick="CRMApp.closeDetail()">×</button>
            </div>
            <div class="detail-body" id="detail-body"></div>
        </aside>
    </div>

    <!-- Login Page -->
    <div id="login-page" class="login-page">
        <div class="login-container">
            <div class="login-logo">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none">
                    <rect width="24" height="24" rx="6" fill="#10b981" />
                    <path d="M7 12l3 3 7-7" stroke="white" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round" />
                </svg>
                <h1>CompliantCare</h1>
                <p>Healthcare Facility CRM</p>
            </div>
            <form id="login-form" class="login-form">
                <div id="auth-error" class="auth-error"></div>
                <div class="form-group">
                    <label for="auth-email">Email</label>
                    <input type="email" id="auth-email" placeholder="Enter your email" required>
                </div>
                <div class="form-group">
                    <label for="auth-password">Password</label>
                    <input type="password" id="auth-password" placeholder="Enter your password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-login" id="login-btn">Sign In</button>
            </form>
        </div>
    </div>

    <!-- Provider Detail Modal -->
    <div id="provider-detail-modal" class="modal-overlay provider-modal-overlay">
        <div class="modal provider-detail-modal">
            <div class="modal-header">
                <div class="provider-modal-title">
                    <h3 id="provider-modal-name">Provider Name</h3>
                    <span class="provider-modal-count" id="provider-modal-count">0 properties</span>
                    <div class="provider-company-info" id="provider-company-info" style="display:none;"></div>
                </div>
                <button class="btn-close" onclick="CRMApp.closeProviderDetail()">×</button>
            </div>
            <div class="modal-body provider-modal-body">
                <div class="provider-modal-content">
                    <div class="provider-modal-left">
                        <!-- Enrichment Section -->
                        <div class="provider-enrichment-section" id="provider-enrichment-section">
                            <div class="enrichment-actions">
                                <button class="btn btn-primary btn-find-directors" id="provider-find-directors-btn"
                                    onclick="CRMApp.enrichProvider()">
                                    <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 20 20"
                                        fill="currentColor">
                                        <path
                                            d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                                    </svg>
                                    <span class="btn-text">Find Directors</span>
                                    <span class="btn-spinner" style="display:none;">
                                        <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10" stroke-opacity="0.25" />
                                            <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round" />
                                        </svg>
                                    </span>
                                </button>
                                <a href="#" class="btn btn-secondary btn-website" id="provider-website-btn"
                                    target="_blank" style="display:none;">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M4.083 9h1.946c.089-1.546.383-2.97.837-4.118A6.004 6.004 0 004.083 9zM10 2a8 8 0 100 16 8 8 0 000-16zm0 2c-.076 0-.232.032-.465.262-.238.234-.497.623-.737 1.182-.389.907-.673 2.142-.766 3.556h3.936c-.093-1.414-.377-2.649-.766-3.556-.24-.56-.5-.948-.737-1.182C10.232 4.032 10.076 4 10 4zm3.971 5c-.089-1.546-.383-2.97-.837-4.118A6.004 6.004 0 0115.917 9h-1.946zm-2.003 2H8.032c.093 1.414.377 2.649.766 3.556.24.56.5.948.737 1.182.233.23.389.262.465.262.076 0 .232-.032.465-.262.238-.234.498-.623.737-1.182.389-.907.673-2.142.766-3.556zm1.166 4.118c.454-1.147.748-2.572.837-4.118h1.946a6.004 6.004 0 01-2.783 4.118zm-6.268 0C6.412 13.97 6.118 12.546 6.03 11H4.083a6.004 6.004 0 002.783 4.118z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    Visit Website
                                </a>
                                <a href="#" class="btn btn-secondary btn-companies-house" id="provider-ch-btn"
                                    target="_blank" style="display:none;">
                                    <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                        <path fill-rule="evenodd"
                                            d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V4zm3 1h6v4H7V5zm6 6H7v2h6v-2z"
                                            clip-rule="evenodd" />
                                    </svg>
                                    Companies House
                                </a>
                            </div>
                        </div>

                        <!-- Nominated Individual (Decision Maker) Section -->
                        <div class="provider-ni-section" id="provider-ni-section" style="display:none;">
                            <h4>
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                                        clip-rule="evenodd" />
                                </svg>
                                Decision Maker
                            </h4>
                            <div class="ni-card" id="ni-card">
                                <div class="ni-info">
                                    <span class="ni-name" id="ni-name"></span>
                                    <span class="ni-role">Nominated Individual</span>
                                </div>
                                <div class="ni-actions">
                                    <a href="#" class="btn btn-sm btn-linkedin" id="ni-linkedin-btn" target="_blank"
                                        title="Search on LinkedIn">
                                        <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor">
                                            <path
                                                d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z" />
                                        </svg>
                                        Find on LinkedIn
                                    </a>
                                    <button class="btn btn-sm btn-enrich" id="ni-enrich-btn"
                                        onclick="CRMApp.enrichNominatedIndividual()">
                                        <svg width="14" height="14" viewBox="0 0 20 20" fill="currentColor">
                                            <path
                                                d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                        </svg>
                                        <span class="btn-text">Enrich Contact</span>
                                        <span class="btn-spinner" style="display:none;">
                                            <svg class="spinner" width="14" height="14" viewBox="0 0 24 24" fill="none"
                                                stroke="currentColor" stroke-width="2">
                                                <circle cx="12" cy="12" r="10" stroke-opacity="0.25" />
                                                <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round" />
                                            </svg>
                                        </span>
                                    </button>
                                </div>
                                <div class="ni-contact-details" id="ni-contact-details" style="display:none;"></div>
                            </div>
                        </div>

                        <!-- Directors Section -->
                        <div class="provider-directors-section" id="provider-directors-section" style="display:none;">
                            <h4>
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path
                                        d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
                                </svg>
                                Directors
                            </h4>
                            <div class="directors-list" id="provider-directors-list"></div>
                            <button class="btn btn-sm btn-view-more-directors" id="view-more-directors-btn"
                                style="display:none;" onclick="CRMApp.toggleDirectorsList()">
                                View <span id="hidden-directors-count">0</span> more
                            </button>
                        </div>

                        <div class="provider-stats-summary" id="provider-stats-summary"></div>
                        <div class="provider-properties-section">
                            <h4>Managed Properties</h4>
                            <div class="provider-properties-list" id="provider-properties-list"></div>
                        </div>
                    </div>
                    <div class="provider-modal-right">
                        <h4>Property Locations</h4>
                        <div class="provider-mini-map" id="provider-mini-map"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- People Detail Modal -->
    <div id="people-detail-modal" class="modal-overlay people-modal-overlay">
        <div class="modal people-detail-modal">
            <div class="modal-header">
                <div class="people-modal-title">
                    <h3 id="people-modal-name">Person Name</h3>
                    <span class="people-modal-provider" id="people-modal-provider">Provider Name</span>
                    <span class="people-modal-count" id="people-modal-count">0 properties</span>
                </div>
                <button class="btn-close" onclick="CRMApp.closePersonDetail()">×</button>
            </div>
            <div class="modal-body people-modal-body">
                <div class="people-modal-content">
                    <div class="people-modal-left">
                        <!-- Person Info Section -->
                        <div class="person-info-section">
                            <div class="person-avatar-large" id="person-avatar">??</div>
                            <div class="person-role" id="person-role">Decision Maker</div>
                        </div>

                        <!-- Person Stats Section -->
                        <div class="person-stats-section" id="person-stats-section">
                            <div class="person-stat-row">
                                <div class="person-stat">
                                    <span class="stat-value" id="person-total-beds">0</span>
                                    <span class="stat-label">Total Beds</span>
                                </div>
                                <div class="person-stat">
                                    <span class="stat-value" id="person-total-properties">0</span>
                                    <span class="stat-label">Properties</span>
                                </div>
                            </div>
                            <div class="person-stat-row">
                                <div class="person-stat">
                                    <span class="stat-value" id="person-avg-beds">0</span>
                                    <span class="stat-label">Avg Beds/Property</span>
                                </div>
                                <div class="person-stat">
                                    <span class="stat-value" id="person-tenure">—</span>
                                    <span class="stat-label">Tenure</span>
                                </div>
                            </div>
                            <div class="person-rating-row" id="person-rating-row">
                                <span class="rating-label">Portfolio Rating:</span>
                                <span class="badge" id="person-rating-badge">Unknown</span>
                            </div>
                        </div>

                        <!-- Contact Details Section -->
                        <div class="person-contact-section" id="person-contact-section">
                            <h4>
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M2.003 5.884L10 9.882l7.997-3.998A2 2 0 0016 4H4a2 2 0 00-1.997 1.884z" />
                                    <path d="M18 8.118l-8 4-8-4V14a2 2 0 002 2h12a2 2 0 002-2V8.118z" />
                                </svg>
                                Contact Information
                            </h4>
                            <div class="person-contact-card">
                                <div class="contact-row">
                                    <span class="contact-label">Phone</span>
                                    <span class="contact-value contact-blurred" id="person-phone"
                                        data-type="phone">••••••••••</span>
                                </div>
                                <div class="contact-row">
                                    <span class="contact-label">Email</span>
                                    <span class="contact-value contact-blurred" id="person-email"
                                        data-type="email">••••••••••••••</span>
                                </div>
                                <div class="contact-row">
                                    <span class="contact-label">LinkedIn</span>
                                    <a href="#" class="contact-value contact-link" id="person-linkedin"
                                        target="_blank">Search on LinkedIn →</a>
                                </div>
                            </div>
                            <div class="person-unlock-section" id="person-unlock-section">
                                <button class="btn btn-primary btn-unlock-person" id="person-unlock-btn"
                                    onclick="CRMApp.enrichPerson()">
                                    <svg class="btn-icon-svg" width="16" height="16" viewBox="0 0 20 20"
                                        fill="currentColor">
                                        <path
                                            d="M9.049 2.927c.3-.921 1.603-.921 1.902 0l1.07 3.292a1 1 0 00.95.69h3.462c.969 0 1.371 1.24.588 1.81l-2.8 2.034a1 1 0 00-.364 1.118l1.07 3.292c.3.921-.755 1.688-1.54 1.118l-2.8-2.034a1 1 0 00-1.175 0l-2.8 2.034c-.784.57-1.838-.197-1.539-1.118l1.07-3.292a1 1 0 00-.364-1.118L2.98 8.72c-.783-.57-.38-1.81.588-1.81h3.461a1 1 0 00.951-.69l1.07-3.292z" />
                                    </svg>
                                    <span class="btn-text">Unlock Contact Info</span>
                                    <span class="btn-spinner" style="display:none;">
                                        <svg class="spinner" width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            stroke="currentColor" stroke-width="2">
                                            <circle cx="12" cy="12" r="10" stroke-opacity="0.25" />
                                            <path d="M12 2a10 10 0 0 1 10 10" stroke-linecap="round" />
                                        </svg>
                                    </span>
                                </button>
                            </div>
                        </div>

                        <!-- Provider Link -->
                        <div class="person-provider-section">
                            <h4>Provider</h4>
                            <div class="person-provider-card" id="person-provider-card"
                                onclick="CRMApp.openProviderFromPerson()">
                                <div class="provider-card-name" id="person-provider-name">Provider Name</div>
                                <div class="provider-card-count" id="person-provider-count">0 properties</div>
                                <svg width="16" height="16" viewBox="0 0 20 20" fill="currentColor"
                                    class="provider-card-arrow">
                                    <path fill-rule="evenodd"
                                        d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                        </div>
                    </div>
                    <div class="people-modal-right">
                        <h4>Property Locations</h4>
                        <div class="people-mini-map" id="people-mini-map"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="scripts/data.js"></script>
    <script src="scripts/enrichment.js"></script>
    <script src="scripts/auth.js"></script>
    <script src="scripts/pipeline.js"></script>
    <script src="scripts/app.js"></script>
</body>

</html>